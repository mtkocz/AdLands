<!doctype html>
<html lang="en">
    <head>
        <meta charset="UTF-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <title>AdLands - Admin Portal</title>

        <!-- Admin Styles (pixelated design system) -->
        <link rel="stylesheet" href="css/admin.css" />
    </head>
    <body>
        <!-- Header -->
        <div id="header">
            <h1>
                AdLands <span class="header-subtitle">Admin Portal</span>
            </h1>
            <div class="header-actions">
                <button id="import-btn" class="btn btn-secondary btn-small">
                    Import JSON
                </button>
                <button id="export-btn" class="btn btn-secondary btn-small">
                    Export JSON
                </button>
                <input
                    type="file"
                    id="import-file"
                    accept=".json"
                    style="display: none"
                />
            </div>
        </div>

        <!-- Main Content -->
        <div id="main-content">
            <!-- Sponsor Cards Panel (left column, top) -->
            <div id="sponsors-list-panel" class="panel">
                <div class="panel-title">Sponsors</div>
                <div class="sponsor-tabs">
                    <button class="sponsor-tab active" data-filter="sponsors">Sponsors</button>
                    <button class="sponsor-tab" data-filter="players">User Territories</button>
                    <button class="sponsor-tab" data-filter="all">All</button>
                </div>
                <button
                    id="add-sponsor-btn"
                    class="btn btn-secondary add-sponsor-btn"
                >
                    + New Sponsor
                </button>
                <div id="sponsors-list">
                    <div class="empty-state">No sponsors created yet</div>
                </div>
            </div>

            <!-- Pricing Panel (left column, bottom) -->
            <div id="pricing-panel" class="panel">
                <!-- Content generated by PricingPanel.js -->
            </div>

            <!-- Sponsor Form Panel (middle column) -->
            <div id="sponsor-form-panel" class="panel">
                <div class="panel-title" id="form-panel-title">Sponsor Information</div>

                <form id="sponsor-form">
                    <!-- VIEW: Sponsor Info -->
                    <div id="view-sponsor-info" class="form-view active">
                        <div id="sponsor-info-section">
                            <div class="form-group">
                                <label for="sponsor-name">Name *</label>
                                <input
                                    type="text"
                                    id="sponsor-name"
                                    name="name"
                                    required
                                    placeholder="e.g., Acme Corp"
                                />
                            </div>
                            <div class="form-group">
                                <label for="sponsor-tagline">Tagline</label>
                                <input
                                    type="text"
                                    id="sponsor-tagline"
                                    name="tagline"
                                    placeholder="e.g., Building Tomorrow"
                                />
                            </div>
                            <div class="form-group">
                                <label for="sponsor-website">Website URL</label>
                                <input
                                    type="url"
                                    id="sponsor-website"
                                    name="websiteUrl"
                                    placeholder="https://example.com"
                                />
                            </div>
                            <div class="form-group">
                                <label>Logo Image (PNG, recommended 256x256)</label>
                                <div class="file-input-group">
                                    <input
                                        type="file"
                                        id="logo-input"
                                        accept="image/png"
                                    />
                                    <label for="logo-input" class="file-input-label"
                                        >Choose File</label
                                    >
                                    <div class="image-preview" id="logo-preview">
                                        <span class="image-preview-placeholder"
                                            >No image</span
                                        >
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="form-view-actions">
                            <button type="button" id="save-sponsor-info-btn" class="btn btn-primary">
                                Save Sponsor
                            </button>
                            <button type="button" id="clear-form-btn-info" class="btn btn-secondary">
                                Clear Form
                            </button>
                        </div>
                    </div>

                    <!-- VIEW: Territories -->
                    <div id="view-territories" class="form-view">
                        <div id="cluster-section">
                            <div class="form-group">
                                <label>Pattern Image (PNG, recommended 256x256)</label>
                                <div class="file-input-group">
                                    <input
                                        type="file"
                                        id="pattern-input"
                                        accept="image/png"
                                    />
                                    <label for="pattern-input" class="file-input-label"
                                        >Choose File</label
                                    >
                                    <div class="image-preview" id="pattern-preview">
                                        <span class="image-preview-placeholder"
                                            >No image</span
                                        >
                                    </div>
                                </div>
                                <div
                                    id="pattern-adjust-group"
                                    class="pattern-adjust-group"
                                >
                                    <label>Scale</label>
                                    <div class="slider-group">
                                        <input
                                            type="range"
                                            id="pattern-scale"
                                            min="0.1"
                                            max="8"
                                            step="0.01"
                                            value="1"
                                        />
                                        <span
                                            class="slider-value"
                                            id="pattern-scale-value"
                                            >1.00x</span
                                        >
                                    </div>
                                    <label>Position (drag preview to adjust)</label>
                                    <div
                                        class="pattern-preview-container"
                                        id="pattern-preview-container"
                                    >
                                        <img id="pattern-preview-large" src="" alt="" />
                                        <span class="pattern-preview-hint"
                                            >Drag to position</span
                                        >
                                    </div>
                                    <div class="color-controls">
                                        <label>Saturation</label>
                                        <div class="slider-group">
                                            <input
                                                type="range"
                                                id="pattern-saturation"
                                                min="0"
                                                max="2"
                                                step="0.01"
                                                value="1"
                                            />
                                            <span
                                                class="slider-value"
                                                id="pattern-saturation-value"
                                                >1.00</span
                                            >
                                        </div>
                                        <label>Input Levels</label>
                                        <div class="levels-group">
                                            <div class="levels-input">
                                                <span class="levels-label">Black</span>
                                                <input
                                                    type="range"
                                                    id="pattern-input-black"
                                                    min="0"
                                                    max="255"
                                                    step="1"
                                                    value="0"
                                                />
                                                <span
                                                    class="slider-value"
                                                    id="pattern-input-black-value"
                                                    >0</span
                                                >
                                            </div>
                                            <div class="levels-input">
                                                <span class="levels-label">Gamma</span>
                                                <input
                                                    type="range"
                                                    id="pattern-input-gamma"
                                                    min="0.1"
                                                    max="3.0"
                                                    step="0.01"
                                                    value="1.0"
                                                />
                                                <span
                                                    class="slider-value"
                                                    id="pattern-input-gamma-value"
                                                    >1.00</span
                                                >
                                            </div>
                                            <div class="levels-input">
                                                <span class="levels-label">White</span>
                                                <input
                                                    type="range"
                                                    id="pattern-input-white"
                                                    min="0"
                                                    max="255"
                                                    step="1"
                                                    value="255"
                                                />
                                                <span
                                                    class="slider-value"
                                                    id="pattern-input-white-value"
                                                    >255</span
                                                >
                                            </div>
                                        </div>
                                        <label>Output Levels</label>
                                        <div class="levels-group">
                                            <div class="levels-input">
                                                <span class="levels-label">Black</span>
                                                <input
                                                    type="range"
                                                    id="pattern-output-black"
                                                    min="0"
                                                    max="255"
                                                    step="1"
                                                    value="0"
                                                />
                                                <span
                                                    class="slider-value"
                                                    id="pattern-output-black-value"
                                                    >0</span
                                                >
                                            </div>
                                            <div class="levels-input">
                                                <span class="levels-label">White</span>
                                                <input
                                                    type="range"
                                                    id="pattern-output-white"
                                                    min="0"
                                                    max="255"
                                                    step="1"
                                                    value="255"
                                                />
                                                <span
                                                    class="slider-value"
                                                    id="pattern-output-white-value"
                                                    >255</span
                                                >
                                            </div>
                                        </div>
                                    </div>
                                    <button
                                        type="button"
                                        id="reset-pattern-btn"
                                        class="btn btn-secondary btn-small reset-pattern-btn"
                                    >
                                        Reset All Adjustments
                                    </button>
                                </div>
                            </div>

                            <!-- Rewards (per-cluster) -->
                            <div class="form-section-label">Rewards</div>
                            <div id="rewards-list"></div>
                            <button id="add-reward-btn" class="btn btn-secondary btn-small">
                                + Add Reward
                            </button>
                        </div>
                        <div class="form-view-actions">
                            <button type="button" id="save-territory-btn" class="btn btn-primary">
                                Save Sponsor
                            </button>
                            <button type="button" id="clear-form-btn-territory" class="btn btn-secondary">
                                Clear Form
                            </button>
                        </div>
                    </div>
                </form>
            </div>

            <!-- Hex Selector Panel (middle right) -->
            <div id="hex-selector-panel" class="panel">
                <div class="panel-title">Hex Selector</div>
                <div id="hex-canvas-container"></div>
                <div id="selection-info">
                    <div class="selection-header">
                        <span
                            >Selected:
                            <span id="selection-count">0</span> items</span
                        >
                        <div class="selection-actions">
                            <button
                                id="clear-selection-btn"
                                class="btn btn-secondary btn-small"
                            >
                                Clear Selection
                            </button>
                        </div>
                    </div>
                    <div id="selected-tiles-list"></div>
                </div>
                <p class="help-text">
                    Click tiles, moons, or billboards to select/deselect. Drag to rotate.
                    Scroll to zoom.
                </p>
            </div>
        </div>

        <!-- Loading Overlay -->
        <div id="loading-overlay">
            <div class="loading-content">
                <div class="loading-title">Loading Admin Portal</div>
                <div class="loading-bar-track">
                    <div class="loading-bar-fill" id="loading-bar-fill"></div>
                </div>
                <div class="loading-status" id="loading-status">Connecting...</div>
            </div>
        </div>

        <!-- Toast Container -->
        <div id="toast-container"></div>

        <!-- Dependencies -->
        <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
        <script src="hexasphere.js"></script>

        <!-- Block browser back/forward navigation from trackpad swipe -->
        <script>
            document.addEventListener("wheel", (e) => {
                // Allow natural scrolling inside overflow containers (panels, lists)
                let el = e.target;
                while (el && el !== document) {
                    const { overflowY } = getComputedStyle(el);
                    if ((overflowY === "auto" || overflowY === "scroll") &&
                        el.scrollHeight > el.clientHeight) {
                        return;
                    }
                    el = el.parentElement;
                }
                e.preventDefault();
            }, { passive: false });
        </script>

        <!-- Shared Utilities -->
        <script src="js/utils/mathUtils.js"></script>

        <!-- Admin Modules -->
        <script src="js/admin/sponsorStorage.js"></script>
        <script src="js/admin/hexTierSystem.js"></script>
        <script src="js/admin/hexSelector.js"></script>
        <script src="js/admin/pricingPanel.js"></script>
        <script src="js/admin/sponsorForm.js"></script>
        <script src="js/admin/rewardConfig.js"></script>
        <script src="js/admin/billboardSponsorPanel.js"></script>
        <script src="js/admin/moonSponsorPanel.js"></script>
        <script src="js/admin/adminApp.js"></script>
    </body>
</html>
